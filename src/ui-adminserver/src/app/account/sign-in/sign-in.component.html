<app-header></app-header>
<div class="background">
  <div class="clr-row">
    <div class="clr-col-lg-6 hidden-md-down clr-align-content-around clr-align-self-center">
    </div>
    <div class="clr-col-lg-6 clr-col-md-12 custom-sign-in-top">
      <div class="sign-in-background">
        <p class="custom-sign-in-title">{{ 'ACCOUNT.SIGN_IN' | translate }}</p>
        <div class="clr-row">
          <div class="clr-col-xs custom-sign-in-input">
            <form #signInForm="ngForm" (ngSubmit)="signIn()">

              <section class="form-block" style="margin-bottom: 0.5rem;">

                <div class="form-group custom-input-padding">
                  <label></label>
                  <label aria-haspopup="true" role="tooltip" [class.invalid]="username.invalid && username.touched"
                    class="tooltip tooltip-validation invalid tooltip-sm">
                    <input type="text" name="username" #username="ngModel" style="width: 225px" required
                      [(ngModel)]="user.username" placeholder="{{ 'ACCOUNT.USERNAME_PLACEHOLDER' | translate }}" />
                    <span class="tooltip-content" *ngIf="username.errors && username.errors.required">
                      {{ 'ACCOUNT.USERNAME_IS_REQUIRED' | translate }}
                    </span>
                  </label>
                </div>

                <div class="form-group custom-input-padding">
                  <label></label>
                  <label aria-haspopup="true" role="tooltip" [class.invalid]="password.invalid && password.touched"
                    class="tooltip tooltip-validation invalid tooltip-sm">
                    <input type="password" name="password" #password="ngModel" style="width: 225px" required
                      [(ngModel)]="user.password" placeholder="{{ 'ACCOUNT.PASSWORD_PLACEHOLDER' | translate }}" />
                    <span class="tooltip-content" *ngIf="password.errors && password.errors.required">
                      {{ 'ACCOUNT.PASSWORD_IS_REQUIRED' | translate }}
                    </span>
                  </label>
                </div>

                <div class="form-group custom-input-padding">
                  <input type="submit" [disabled]="signInForm.invalid" class="btn btn-primary" style="width: 225px"
                    value="{{ 'ACCOUNT.SIGN_IN' | translate }}" />
                </div>

              </section>

            </form>

            <div style="text-align: right; margin-right: 0.5rem;">
              <a href="javascript:void(0)">忘记密码</a>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <clr-wizard #wizard [(clrWizardOpen)]="_open" clrWizardSize="lg" [clrWizardClosable]="false">
    <clr-wizard-title>Adminserver Initialization</clr-wizard-title>

    <clr-wizard-button [type]="'next'">Next/下一步</clr-wizard-button>

    <clr-wizard-page clrWizardPagePreventDefault="true" (clrWizardPageOnCommit)="onWelcome()">
      <ng-template clrPageTitle>Welcome to Adminserver</ng-template>
      <ng-template clrPageNavTitle>Welcome</ng-template>
      <clr-spinner *ngIf="loadingFlag">
        Loading
      </clr-spinner>
      <clr-alert *ngIf="errorFlag" [clrAlertType]="'alert-danger'" [clrCloseButtonAriaLabel]="'Close Answer alert'">
        <clr-alert-item>
          Initialization error! Please check that the docker is working normally.
          <br>
          初始化错误！请检查Docker是否正常运行。
        </clr-alert-item>
      </clr-alert>
      <p>
        EN: Welcome to Adminserver! Because this is the first time for the initialization process, you need to complete
        the following configurations to start the system normally.
        <br>
        汉: 欢迎使用Adminserver！由于这是第一次进行初始化流程，因此需要完成以下几项配置后才能正常启动系统。
      </p>
    </clr-wizard-page>

    <clr-wizard-page clrWizardPagePreventDefault="true" (clrWizardPageOnCommit)="onVerify()"
      [clrWizardPageNextDisabled]="getUUID.pristine || !uuidForm.valid">
      <ng-template clrPageTitle>Verify UUID</ng-template>
      <clr-spinner *ngIf="loadingFlag">
        Loading
      </clr-spinner>
      <clr-alert *ngIf="errorFlag" [clrAlertType]="'alert-danger'" [clrCloseButtonAriaLabel]="'Close Answer alert'">
        <clr-alert-item>
          Incorrect UUID! Please re-enter UUID!
          <br>
          UUID错误！请重新输入！
        </clr-alert-item>
      </clr-alert>
      <form clrForm #uuidForm="ngForm" [class.hide]="loadingFlag">
        <p>
          In order to confirm your identity, you need to enter the UUID in the /data/board/secrets folder for the
          next configuration.
          <br>
          为了确认您的身份，需要您输入/data/board/secrets 文件夹中的UUID以进行下一步的配置。
        </p>
        <clr-input-container>
          <label>UUID</label>
          <input clrInput required [(ngModel)]="uuid" name="uuid" #getUUID="ngModel" />
          <clr-control-error>
            This field is required!<br>必填项！
          </clr-control-error>
        </clr-input-container>
      </form>
    </clr-wizard-page>

    <clr-wizard-page clrWizardPagePreventDefault="true" (clrWizardPageOnCommit)="onInitDB()"
      [clrWizardPageNextDisabled]="disableDbPwdFrom || !dbPwdFrom.valid" *ngIf="showInitDB">
      <ng-template clrPageTitle>Initialize Database</ng-template>
      <clr-spinner *ngIf="loadingFlag">
        Loading
      </clr-spinner>
      <clr-alert *ngIf="errorFlag" [clrAlertType]="'alert-danger'" [clrCloseButtonAriaLabel]="'Close Answer alert'">
        <clr-alert-item>
          Database initialization failed! Please check that the docker is working normally.
          <br>
          数据库初始化失败！请检查Docker是否正常运行。
        </clr-alert-item>
      </clr-alert>
      <clr-alert *ngIf="errorVerifyFlag" [clrAlertType]="'alert-danger'"
        [clrCloseButtonAriaLabel]="'Close Answer alert'">
        <clr-alert-item>
          Passwords are not identical.
          <br>
          两次密码不一致！
        </clr-alert-item>
      </clr-alert>
      <form clrForm #dbPwdFrom="ngForm" [class.hide]="loadingFlag">
        <p>
          Requires to configure the database password to initialize the database. This step will decompress some image
          packages and may take some time.
          <br>
          您需要配置数据库密码以初始化数据库。该步骤会解压缩一些镜像包，可能需要一些时间。
        </p>
        <clr-password-container>
          <label>Password</label>
          <input clrPassword required [(ngModel)]="dbPwd" name="dbPwd" minlength="8" (ngModelChange)="verifyDBPwd()"
            [ngModelOptions]="{updateOn: 'blur'}" />
          <clr-control-helper>Must contain at least 8 characters.</clr-control-helper>
          <clr-control-error *clrIfError="'required'">
            This field is required!<br>必填项！
          </clr-control-error>
          <clr-control-error *clrIfError="'minlength'">
            It must be at least 8 characters!
            <br>
            至少8个字符！
          </clr-control-error>
        </clr-password-container>
        <clr-password-container>
          <label>Confirm Password</label>
          <input clrPassword required [(ngModel)]="dbPwdConfirm" name="dbPwdConfirm" minlength="8"
            (ngModelChange)="verifyDBPwd()" [ngModelOptions]="{updateOn: 'blur'}" />
          <clr-control-helper>Must contain at least 8 characters.</clr-control-helper>
          <clr-control-error *clrIfError="'required'">
            This field is required!<br>必填项！
          </clr-control-error>
          <clr-control-error *clrIfError="'minlength'">
            It must be at least 8 characters!
            <br>
            至少8个字符！
          </clr-control-error>
        </clr-password-container>
      </form>
    </clr-wizard-page>

    <clr-wizard-page clrWizardPagePreventDefault="true" (clrWizardPageOnCommit)="onInitSSH()"
      [clrWizardPageNextDisabled]="getSSHUsername.pristine || getSSHPassword.pristine || !sshForm.valid"
      *ngIf="showInitSSH">
      <ng-template clrPageTitle>Initialize SSH Account</ng-template>
      <clr-spinner *ngIf="loadingFlag">
        Loading
      </clr-spinner>
      <clr-alert *ngIf="errorFlag" [clrAlertType]="'alert-danger'" [clrCloseButtonAriaLabel]="'Close Answer alert'">
        <clr-alert-item>
          Network error or account error, please try again!
          <br>
          网络错误或者账户错误，请重试！
        </clr-alert-item>
      </clr-alert>
      <form clrForm #sshForm="ngForm" [class.hide]="loadingFlag">
        <p>
          Please enter the account and password of the host machine. Note: The account needs certain permissions to
          install and run related components. It will take some time to run.
          <br>
          请输入当前主机的账户及密码。注意：账户需要一定的权限用于安装并运行相关的组件。运行需要一些时间。
        </p>
        <clr-input-container>
          <label>Account</label>
          <input clrInput required [(ngModel)]="sshAccount.username" name="sshUsername" #getSSHUsername="ngModel" />
          <clr-control-error>
            This field is required!<br>必填项！
          </clr-control-error>
        </clr-input-container>
        <clr-password-container>
          <label>Confirm Password</label>
          <input clrPassword required [(ngModel)]="sshAccount.password" name="sshPassword" #getSSHPassword="ngModel" />
          <clr-control-error *clrIfError="'required'">
            This field is required!<br>必填项！
          </clr-control-error>
        </clr-password-container>
      </form>
    </clr-wizard-page>

    <clr-wizard-page>
      <ng-template clrPageTitle>Initialize Account</ng-template>
      <clr-spinner *ngIf="loadingFlag">
        Loading
      </clr-spinner>
      <clr-alert *ngIf="errorFlag" [clrAlertType]="'alert-danger'" [clrCloseButtonAriaLabel]="'Close Answer alert'">
        <clr-alert-item>
          Network error or docker error, please try again!
          <br>
          网络错误或者docker运行错误，请重试！
        </clr-alert-item>
      </clr-alert>
      <clr-alert *ngIf="errorVerifyFlag" [clrAlertType]="'alert-danger'"
        [clrCloseButtonAriaLabel]="'Close Answer alert'">
        <clr-alert-item>
          Passwords are not identical.
          <br>
          两次密码不一致！
        </clr-alert-item>
      </clr-alert>
      <form clrForm #accountForm="ngForm" [class.hide]="loadingFlag">
        <p>
          Initialize the administrator password of adminserver. The admin account will be shared with the board.
          <br>
          初始化adminserver的管理员密码。该admin账户将与board共用。
        </p>
        <clr-password-container>
          <label>Password</label>
          <input clrPassword required [(ngModel)]="account.password" name="accountPassword" minlength="8"
            (ngModelChange)="verifyAccountPwd()" [ngModelOptions]="{updateOn: 'blur'}" />
          <clr-control-helper>Must contain at least 8 characters.</clr-control-helper>
          <clr-control-error *clrIfError="'required'">
            This field is required!<br>必填项！
          </clr-control-error>
          <clr-control-error *clrIfError="'minlength'">
            It must be at least 8 characters!
            <br>
            至少8个字符！
          </clr-control-error>
        </clr-password-container>
        <clr-password-container>
          <label>Confirm Password</label>
          <input clrPassword required [(ngModel)]="account.passwordConfirm" name="accountPasswordConfirm" minlength="8"
            (ngModelChange)="verifyAccountPwd()" [ngModelOptions]="{updateOn: 'blur'}" />
          <clr-control-helper>Must contain at least 8 characters.</clr-control-helper>
          <clr-control-error *clrIfError="'required'">
            This field is required!<br>必填项！
          </clr-control-error>
          <clr-control-error *clrIfError="'minlength'">
            It must be at least 8 characters!
            <br>
            至少8个字符！
          </clr-control-error>
        </clr-password-container>
      </form>
      <ng-template clrPageButtons>
        <button class="btn btn-primary" [type]="'custom-finish'" [disabled]="disableAccountFrom || !accountForm.valid"
          (click)="onInitAccount()">Apply</button>
      </ng-template>
    </clr-wizard-page>
  </clr-wizard>
</div>