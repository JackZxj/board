<environment-value
  *ngIf="isOpenEnvironment"
  [inputEnvsData]="defaultEnvsData"
  [(isOpen)]="isOpenEnvironment"
  (onConfirm)="setEnvironment($event)">
</environment-value>
<clr-modal [(clrModalOpen)]="isOpen" [clrModalSize]="'lg'" [clrModalClosable]="!imageInBuilding">
  <h3 class="modal-title">{{ "IMAGE.CREATE_IMAGE_TITLE" | translate }}</h3>
  <fieldset class="modal-body fieldSet-default">
    <clr-alert [(clrAlertClosed)]="!isNewImageAlertOpen" [clrAlertType]="newImageAlertType">
      <div class="alert-item">
        <span class="alert-text">{{newImageErrMessage | translate}}</span>
      </div>
    </clr-alert>
    <div style="display: flex">
      <div class="create-image-container">
        <div class="create-image-line-container">
          <label class="base-text">{{"IMAGE.CREATE_IMAGE_SELECT_IMAGE_TEMP" | translate}}:</label>
          <cs-dropdown class="base-margin-left"
                       [dropdownDisabled]="imageInBuilding"
                       [dropdownWidth]="300"
                       [dropdownDefaultText]="'Docker File Template'"
                       [dropdownList]="imageTemplateList"
                       [dropdownListTextKey]="'name'">
          </cs-dropdown>
        </div>
        <cs-input [inputIsRequired]="true"
                  [inputPattern]="patternNewImageName"
                  [inputLabel]="'IMAGE.CREATE_IMAGE_NEW_IMAGE_NAME'|translate"
                  [disabled]="imageInBuilding"
                  [simpleFiled]="customerNewImage.image_name"
                  (onCheck)="customerNewImage.image_name = $event;asyncGetDockerFilePreviewInfo()"></cs-input>
        <cs-input [inputIsRequired]="true"
                  [inputPattern]="patternNewImageTag"
                  [inputLabel]="'IMAGE.CREATE_IMAGE_IMAGE_TAG'|translate"
                  [disabled]="imageInBuilding"
                  [simpleFiled]="customerNewImage.image_tag"
                  (onCheck)="customerNewImage.image_tag = $event;asyncGetDockerFilePreviewInfo()"></cs-input>
        <cs-input [inputIsRequired]="true"
                  [inputPattern]="patternBaseImage"
                  [inputLabel]="'IMAGE.CREATE_IMAGE_BASE_IMAGE'|translate"
                  [disabled]="imageInBuilding"
                  [simpleFiled]="customerNewImage.image_dockerfile.image_base"
                  (onCheck)="customerNewImage.image_dockerfile.image_base = $event;getDockerFilePreviewInfo()"></cs-input>
        <cs-input [inputPattern]="patternEntryPoint"
                  [inputLabel]="'IMAGE.CREATE_IMAGE_IMAGE_ENTRYPOINT'|translate"
                  [disabled]="imageInBuilding"
                  [simpleFiled]="customerNewImage.image_dockerfile.image_entrypoint"
                  (onCheck)="customerNewImage.image_dockerfile.image_entrypoint = $event;getDockerFilePreviewInfo()"></cs-input>
        <cs-input [inputType]="1"
                  [inputLabel]="'IMAGE.CREATE_IMAGE_IMAGE_ENV'|translate"
                  [disabled]="imageInBuilding"
                  [simpleFiled]="envsDescription"
                  (onEdit)="isOpenEnvironment = true"></cs-input>
        <cs-input-array [inputArraySource]="imageVolume"
                        [inputArrayPattern]="patternVolume"
                        [disabled]="imageInBuilding"
                        [inputArrayLabelText]="'IMAGE.CREATE_IMAGE_IMAGE_VOLUME'|translate"
                        (onCheck)="getDockerFilePreviewInfo()"
                        (onMinus)="getDockerFilePreviewInfo()"></cs-input-array>
        <cs-input-array [inputArraySource]="imageRun"
                        [inputArrayPattern]="patternRun"
                        [disabled]="imageInBuilding"
                        [inputArrayLabelText]="'IMAGE.CREATE_IMAGE_IMAGE_RUN'|translate"
                        (onCheck)="getDockerFilePreviewInfo()"
                        (onMinus)="getDockerFilePreviewInfo()"></cs-input-array>
        <cs-input-array [inputArraySource]="imageExpose"
                        [inputArrayIsRequired]="true"
                        [inputArrayPattern]="patternExpose"
                        [disabled]="imageInBuilding"
                        [inputArrayLabelText]="'IMAGE.CREATE_IMAGE_IMAGE_EXPOSE'|translate"
                        (onCheck)="getDockerFilePreviewInfo()"
                        (onMinus)="getDockerFilePreviewInfo()"></cs-input-array>
        <div class="create-image-line-container ">
          <label class="base-text">{{"IMAGE.CREATE_IMAGE_UPLOAD_ARCHIVES" | translate}}:</label>
          ï»¿<input type="file"
                  class="upload-file-input"
                  [disabled]="imageInBuilding || isUploadFileIng"
                  (change)="uploadFile($event)"
                  accept="*.*">
          <span *ngIf="isUploadFileIng" class="spinner spinner-sm"></span>
        </div>
        <div class="file-list"
             *ngFor="let file of filesList.get(customerNewImage.image_name)">
          <clr-icon class="dynamic-icon" shape="minus" (click)="removeFile(file)"></clr-icon>
          {{file.file_name}}
        </div>
        <div class="create-image-area-container">
          <label for="areaCommand" class="base-text">{{"IMAGE.CREATE_IMAGE_COMMAND" | translate}}:</label>
          <textarea id="areaCommand"
                    rows="3"
                    class="area-command"
                    (keypress)="shieldEnter($event)"
                    [(ngModel)]="customerNewImage.image_dockerfile.image_cmd"
                    [disabled]="imageInBuilding">
          </textarea>
        </div>
      </div>
      <div class="console-container">
        <textarea title="" id="areaStatus" class="area-status" readonly>{{consoleText}}</textarea>
        <button class="btn btn-primary default-primary"
                [disabled]="imageInBuilding || !isInputComponentsValid || isUploadFileIng"
                (click)="buildImage()">
          {{"IMAGE.CREATE_IMAGE_BUILD_IMAGE" | translate}}
        </button>
        <button class="btn btn-primary default-primary"
                *ngIf="imageInBuilding"
                [disabled]="lastJobNumber <= 0"
                (click)="cancelBuildImage()">
          {{"IMAGE.CREATE_IMAGE_CANCEL_WAIT" | translate}}
        </button>
        <span *ngIf="imageInBuilding" class="spinner spinner-sm"></span>
      </div>
    </div>
  </fieldset>
</clr-modal>