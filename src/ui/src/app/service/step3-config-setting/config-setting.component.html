<div class="config-container">
  <span>{{"SERVICE.STEP_4_SERVICE_CONFIG_TITLE"|translate}}:</span>
  <div class="config-service-info-container">
    <div *ngIf="noPortForExtent" class="alert alert-danger" role="alert">
       {{"SERVICE.STEP_4_DANGER_MESSAGE" | translate}}
    </div>
    <div class="config-service-info-line">
      <cs-input class="base-input"
                [inputIsRequired]="true"
                [disabled]="isActionWip"
                [inputPattern]="patternServiceName"
                [inputLabel]="'SERVICE.STEP_4_SERVICE_NAME' | translate"
                [customerValidatorAsyncFunc]="checkServiceNameFun"
                [simpleFiled]="uiData.serviceName"
                [inputPlaceholder]="'SERVICE.STEP_4_SERVICE_OF_NAME'| translate"
                (onCheck)="setServiceName($event)">
      </cs-input>
    </div>
    <div class="config-service-info-line">
      <span class="instance">{{"SERVICE.STEP_4_PUBLIC" | translate}}:</span>
      <input title=""
             type="checkbox"
             class="base-margin-left"
             [checked]="uiData.servicePublic"
             [(ngModel)]="uiData.servicePublic">
    </div>
    <div class="config-service-info-line">
      <cs-input class="base-input"
                [inputIsRequired]="true"
                [inputFiledType]="1"
                [inputMin]="1"
                [inputMax]="99"
                [disabled]="isActionWip"
                [inputLabel]="'SERVICE.STEP_4_INSTANCE' | translate"
                [simpleFiled]="uiData.instance"
                (onCheck)="uiData.instance = $event">
      </cs-input>
    </div>
  </div>
  <div class="advanced-container" (click)="showAdvanced = !showAdvanced">
    <div [ngClass]="{'advanced-open':showAdvanced,'advanced-close':!showAdvanced}" class="step-arrow"></div>
    <span class="base-margin-left">{{"SERVICE.STEP_4_ADVANCED_CONFIG"|translate}}</span>
    <div *ngIf="uiData.externalServiceList.length == 0"
         class="alert alert-warning base-margin-left"
         role="alert">
      {{"SERVICE.STEP_4_WARNING_MESSAGE" | translate}}
    </div>
  </div>
  <div *ngIf="showAdvanced" class="advanced-item-container" (click)="showExternal = !showExternal">
    <div class="advanced-item-icon-container"
         [ngClass]="{'external-close':showExternal,'external-open':!showExternal}">
      <clr-icon shape="caret up" class="advanced-item-icon"></clr-icon>
    </div>
    <span class="base-margin-left">{{"SERVICE.STEP_4_EXTERNAL_SERVICE"|translate}}:</span>
  </div>
  <div *ngIf="showExternal && showAdvanced">
    <div class="external-container" *ngFor="let externalService of uiData.externalServiceList;let iIndex = index">
      <div class="external-line-container">
        <clr-icon class="plus-icon"
                  shape="minus"
                  (click)="removeContainerInfo(iIndex)">
        </clr-icon>
        <span class="external-title icon">{{"SERVICE.STEP_4_CONTAINER"|translate}}:</span>
        <cs-dropdown class="base-margin-left"
                     [dropdownList]="uiPreData.containerList"
                     [dropdownListTextKey]="'name'"
                     [dropdownWidth]="310"
                     [dropdownDisabled]="isActionWip"
                     [dropdownDefaultText]="getContainerDropdownText(iIndex) | translate"
                     (onChange)="setExternalInfo($event, iIndex)">
        </cs-dropdown>
      </div>
      <div class="external-line-container">
        <span class="external-title">{{"SERVICE.STEP_4_PORT"|translate}}:</span>
        <cs-dropdown class="base-margin-left"
                     [dropdownDisabled]="externalService.container_name == '' || isActionWip"
                     [dropdownList]="getContainerPorts(externalService.container_name)"
                     [dropdownWidth]="310"
                     [dropdownDefaultText]="getContainerPortDropdownText(iIndex) | translate"
                     (onChange)="externalService.node_config.target_port = $event">
        </cs-dropdown>
      </div>
      <div class="external-line-container">
        <cs-input class="base-input"
                  [inputFiledType]="1"
                  [simpleFiled]="externalService.node_config.node_port"
                  [disabled]="!radNode.checked || isActionWip"
                  [inputLabel]="'SERVICE.STEP_4_NODE_PORT' | translate"
                  [inputIsRequired]="true"
                  [inputMin]="30000"
                  [inputMax]="32766"
                  [inputPlaceholder]="'SERVICE.STEP_4_EXTERNAL_PORT'| translate"
                  (onCheck)="setNodePort(iIndex,$event)">
        </cs-input>
        <div class="radio-inline external-radio-container">
          <input #radNode
                 title=""
                 type="radio"
                 [name]="'port' + iIndex"
                 [id]="'radNode' + iIndex"
                 [disabled]="isActionWip"
                 (change)="externalService.load_balancer_config.external_access = ''" checked>
          <label [for]="'radNode' + iIndex"></label>
        </div>
      </div>
      <div class="external-line-container" style="cursor: not-allowed">
        <cs-input class="base-input"
                  [simpleFiled]="externalService.load_balancer_config.external_access"
                  [disabled]="!radExternal.checked || isActionWip"
                  [inputLabel]="'SERVICE.STEP_4_EXTERNAL_ACCESS' | translate"
                  (onCheck)="externalService.load_balancer_config.external_access = $event">
        </cs-input>
        <div class="radio-inline external-radio-container disabled">
          <input #radExternal
                 title=""
                 type="radio"
                 [disabled]="true"
                 [name]="'port' + iIndex"
                 [id]="'radExternal' + iIndex"
                 (change)="externalService.node_config.node_port = 0">
          <label [for]="'radExternal'+ iIndex"></label>
        </div>
      </div>
    </div>
    <clr-icon class="plus-icon"
              shape="plus"
              [ngClass]="{'disabled':!isCanAddContainerInfo}"
              (click)="addContainerInfo()">
    </clr-icon>
    <span class="base-margin-left">{{"SERVICE.STEP_4_EXTERNAL_SERVICE_ADD"|translate}}</span>
  </div>
  <div *ngIf="showAdvanced" class="advanced-item-container" (click)="showCollaborative = !showCollaborative">
    <div class="advanced-item-icon-container"
         [ngClass]="{'collaborative-close':showCollaborative,'collaborative-open':!showCollaborative}">
      <clr-icon shape="caret up" class="advanced-item-icon"></clr-icon>
    </div>
    <span class="base-margin-left">{{"SERVICE.STEP_4_COLLABORATIVE"|translate}}:</span>
  </div>
  <div *ngIf="showCollaborative && showAdvanced">
    <div class="collaborative-container" *ngFor="let obj of collaborativeList; let i = index">
      <clr-icon class="plus-icon"
                shape="minus"
                (click)="collaborativeList.splice(collaborativeList.indexOf(obj), 1)">
      </clr-icon>
      <span class="service">{{"SERVICE.STEP_4_SERVICE"|translate}}:</span>
      <cs-dropdown class="base-margin-left"
                   [dropdownList]="collaborativeServiceList"
                   [dropdownWidth]="310"
                   [dropdownDisabled]="isActionWip"
                   [dropdownDefaultText]="'SERVICE.STEP_4_SELECT_SERVICE' | translate">
      </cs-dropdown>
    </div>
    <clr-icon shape="plus"
              class="plus-icon"
              [ngClass]="{'disabled':collaborativeServiceList.length == 0}"
              (click)="addOneCollaborativeService()">
    </clr-icon>
  </div>

  <div *ngIf="showAdvanced" class="advanced-item-container" (click)="showNodeSelector = !showNodeSelector">
    <div class="advanced-item-icon-container"
         [ngClass]="{'collaborative-close':showNodeSelector,'collaborative-open':!showNodeSelector}">
      <clr-icon shape="caret up" class="advanced-item-icon"></clr-icon>
    </div>
    <span class="base-margin-left">{{"SERVICE.STEP_4_NODE_SELECTOR"|translate}}:</span>
  </div>
  <cs-dropdown *ngIf="showNodeSelector && showAdvanced"
               style="margin-left: 190px;"
               [dropdownList]="nodeSelectorList"
               [dropdownDisabled]="isActionWip"
               [dropdownWidth]="310"
               [dropdownDefaultText]="nodeSelectorDefaultText | translate "
               (onChange)="uiData.nodeSelector = $event">
  </cs-dropdown>
</div>
<div class="button-container">
  <button class="btn btn-default" (click)="cancelBuildService()" [disabled]="isActionWip">
    {{"BUTTON.CANCEL" | translate}}
  </button>
  <button class="btn btn-default" [disabled]="true">
    {{"BUTTON.TEST" | translate}}
  </button>
  <button class="btn btn-default" (click)="backUpStep()" [disabled]="isActionWip">
    {{"BUTTON.BACK" | translate}}
  </button>
  <button class="btn btn-default"
          (click)="forward()"
          [disabled]="noPortForExtent || uiData.externalServiceList.length == 0 || isActionWip">
    {{"BUTTON.NEXT" | translate}}
  </button>
  <span *ngIf="isDeleteInWIP" class="spinner spinner-sm"></span>
</div>
