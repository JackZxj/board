<div class="select-image-container">
  <div class="image-source-container">
    <span class="base-text">{{"SERVICE.STEP_2_SELECT_IMAGE_SOURCE" | translate}}:</span>
    <div class="btn-group base-margin-left">
      <button class="btn" [ngClass]="{'btn-primary':imageSource == 0}">Board registry</button>
      <button class="btn" [ngClass]="{'btn-primary':imageSource == 1}" [disabled]="true">Docker hub</button>
    </div>
  </div>
  <div *ngFor="let selectedImage of imageSelectList;let iImage = index" class="dynamic-image-source-container">
    <div class="dynamic-icon-container">
      <clr-icon *ngIf="iImage == imageSelectList.length - 1" class="dynamic-icon" shape="plus"
                (click)="modifySelectImage(iImage)"></clr-icon>
      <clr-icon *ngIf="iImage < imageSelectList.length - 1" class="dynamic-icon" shape="minus"
                (click)="modifySelectImage(iImage)"></clr-icon>
    </div>
    <cs-dropdown class="base-margin-left"
                 [Width]="300"
                 [List]="imageSourceList"
                 [DefaultText]="selectedImage.image_name"
                 [TextKey]="'image_name'"
                 (OnChange)="changeSelectImage(iImage,$event)"
                 (OnOnlyClickItem)="clickSelectImage(iImage,$event)">
    </cs-dropdown>
    <cs-dropdown class="base-margin-left"
                 *ngIf="imageDetailSourceList.get(selectedImage.image_name)"
                 [Width]="150"
                 [DefaultText]="imageDetailSelectList.get(selectedImage.image_name)?.image_tag"
                 [List]="imageDetailSourceList.get(selectedImage.image_name)"
                 [TextKey]="'image_tag'"
                 (OnChange)="changeSelectImageDetail(selectedImage.image_name,$event)">
    </cs-dropdown>
  </div>
</div>
<clr-modal *ngIf="isOpenNewImage"
           [(clrModalOpen)]="isOpenNewImage"
           [clrModalSize]="'lg'"
           [clrModalClosable]="!isNeedAutoRefreshImageList">
  <h3 class="modal-title">{{ "SERVICE.STEP_2_CREATE_IMAGE" | translate }}</h3>
  <fieldset class="modal-body fieldSet-default">
    <div style="display: flex">
      <div class="create-image-container">
        <div class="create-image-line-container">
          <label class="base-text">{{"SERVICE.STEP_2_SELECT_IMAGE_TEMP" | translate}}:</label>
          <cs-dropdown class="base-margin-left"
                       [Disabled]="isNeedAutoRefreshImageList"
                       [Width]="300"
                       [DefaultText]="'Docker File Template'"
                       [List]="imageTemplateList"
                       [TextKey]="'name'">
          </cs-dropdown>
        </div>
        <cs-input [inputMaxlength]="255"
                  [Label]="'SERVICE.STEP_2_NEW_IMAGE_NAME'|translate"
                  [validatorFns]="testValidatorFn"
                  [disabled]="isNeedAutoRefreshImageList"
                  [SimpleFiled]="outputData.image_name"
                  (OnCheck)="outputData.image_name = $event;asyncGetDockerFilePreviewInfo()"></cs-input>
        <cs-input [inputMaxlength]="255"
                  [Label]="'SERVICE.STEP_2_IMAGE_TAG'|translate"
                  [disabled]="isNeedAutoRefreshImageList"
                  [validatorFns]="testValidatorFn"
                  [SimpleFiled]="outputData.image_tag"
                  (OnCheck)="outputData.image_tag = $event;asyncGetDockerFilePreviewInfo()"></cs-input>
        <cs-input [inputMaxlength]="255"
                  [Label]="'SERVICE.STEP_2_BASE_IMAGE'|translate"
                  [disabled]="isNeedAutoRefreshImageList"
                  [SimpleFiled]="outputData.image_dockerfile.image_base"
                  (OnCheck)="outputData.image_dockerfile.image_base = $event;getDockerFilePreviewInfo()"></cs-input>
        <cs-input [inputMaxlength]="255"
                  [Label]="'SERVICE.STEP_2_IMAGE_ENTRYPOINT'|translate"
                  [disabled]="isNeedAutoRefreshImageList"
                  [SimpleFiled]="outputData.image_dockerfile.image_entrypoint"
                  (OnCheck)="outputData.image_dockerfile.image_entrypoint = $event;getDockerFilePreviewInfo()"></cs-input>
        <cs-input-array [Source]="imageVolume"
                        [disabled]="isNeedAutoRefreshImageList"
                        [Label]="'SERVICE.STEP_2_IMAGE_VOLUME'|translate"
                        (OnCheck)="getDockerFilePreviewInfo()"
                        (OnMinus)="getDockerFilePreviewInfo()"></cs-input-array>
        <cs-input-array [Source]="imageRun"
                        [disabled]="isNeedAutoRefreshImageList"
                        [Label]="'SERVICE.STEP_2_IMAGE_RUN'|translate"
                        (OnCheck)="getDockerFilePreviewInfo()"
                        (OnMinus)="getDockerFilePreviewInfo()"></cs-input-array>
        <div class="create-image-line-container ">
          <label class="base-text">{{"SERVICE.STEP_2_UPLOAD_ARCHIVES" | translate}}:</label>
          ï»¿<input type="file"
                  class="upload-file-input"
                  [disabled]="isNeedAutoRefreshImageList"
                  (change)="uploadFile($event)"
                  accept="*.*">
        </div>
        <div style="margin-left: 190px;font-size: 10px"
             *ngFor="let file of filesList.get(outputData.image_name)">
          <clr-icon class="dynamic-icon" shape="minus"></clr-icon>
          {{file.file_name}}
        </div>
        <div class="create-image-area-container">
          <label for="areaCommand" class="base-text">{{"SERVICE.STEP_2_COMMAND" | translate}}:</label>
          <textarea id="areaCommand"
                    rows="3"
                    class="area-command"
                    (keypress)="shieldEnter($event)"
                    [(ngModel)]="outputData.image_dockerfile.image_cmd"
                    [disabled]="isNeedAutoRefreshImageList"></textarea>
        </div>
      </div>
      <div class="console-container">
        <textarea title="" id="areaStatus" class="area-status" readonly>{{consoleText}}</textarea>
        <button class="btn btn-primary default-primary" [disabled]="isNeedAutoRefreshImageList" (click)="buildImage()">
          {{"SERVICE.STEP_2_BUILD_IMAGE" | translate}}
        </button>
        <span *ngIf="isNeedAutoRefreshImageList" class="spinner spinner-sm"></span>
      </div>
    </div>
  </fieldset>
</clr-modal>
<button class="btn btn-default" [disabled]="!isCanNextStep" (click)="forward()">Next</button>
